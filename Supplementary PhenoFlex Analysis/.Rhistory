purrr::map_dbl(Vassal_easy,~ PhenoFlex_GDHwrapper(.x, Fit_res_RIES$model_fit$par))
Vassal_pheno$val <- 1
riesling_pheno <- rbind(Bergheim_pheno,
Vassal_pheno,
MB_pheno,
Bordeaux_pheno,
LF_pheno,
Ontario_pheno,
PA_pheno)
aRIES=RMSEP(riesling_pheno$predicted, riesling_pheno$pheno, na.rm = T)
riesling_phenoval<- rbind(Vassal_pheno,
MB_pheno,
Bordeaux_pheno,
LF_pheno,
Ontario_pheno,
PA_pheno)
bRIES=RMSEP(riesling_phenoval$predicted, riesling_phenoval$pheno, na.rm = T)
cRIES=RMSEP(Bergheim_pheno$predicted, Bergheim_pheno$pheno, na.rm = T)
dRIES=mean(riesling_pheno$predicted-riesling_pheno$pheno, na.rm = T)
eRIES=mean(riesling_phenoval$predicted-riesling_phenoval$pheno, na.rm = T)
fRIES=mean(Bergheim_pheno$predicted-Bergheim_pheno$pheno, na.rm = T)
aRIES #RMSEall
bRIES #RMSEval
cRIES #RMSEcal
dRIES #biasall
eRIES #biasval
fRIES #biascal
```{r All results from Method 1}
all_pheno <- rbind(cabsauv_phenoval,
riesling_phenoval)
RMSEP(all_pheno$predicted, all_pheno$pheno, na.rm = T)
# Overall RMSE for fitting in cold location  = 7.42
mean(all_pheno$predicted - all_pheno$pheno, na.rm = T)
aRIES #RMSEall
bRIES #RMSEval
aRIES #RMSEall
# Overall RMSE for fitting in cold location  = 7.34
mean(all_pheno$predicted - all_pheno$pheno, na.rm = T)
aRIES #RMSEall
bRIES #RMSEval
cRIES #RMSEcal
dRIES #biasall
eRIES #biasval
fRIES #biascal
aCS #RMSEall
bCS #RMSEval
cCS #RMSEcal
dCS #biasall
eCS #biasval
fCS #biascal
# FIT ENTIRE DATASET
```{r Riesling - Method 2}
riesling.bb <- data.frame(riesling_pheno) %>%
dplyr::select(bb.date, Year, bb.doy, Location, BBCH.scale, Dataset, Cultivar, Observer) %>%
mutate(pheno = as.numeric(bb.doy)) %>%
filter(
Cultivar == "Riesling") %>% arrange(Location, Year)
wdat.cal <- wdat3[!(wdat3$Location == "Portland_NY"),]
rownames(wdat.cal) <- NULL
wdat.cal <- droplevels(wdat.cal)
# modifying years for weather dataset
wdat.cal$yearmod <- wdat.cal$Year
wdat.cal$yearmod[wdat.cal$Location == "Colmar"] <- wdat.cal$Year[wdat.cal$Location == "Colmar"] + 1000
wdat.cal$yearmod[wdat.cal$Location == "Lewisberg_PA"] <- wdat.cal$Year[wdat.cal$Location == "Lewisberg_PA"] + 2000
wdat.cal$yearmod[wdat.cal$Location == "Lower_Franconia"] <- wdat.cal$Year[wdat.cal$Location == "Lower_Franconia"] + 3000
wdat.cal$yearmod[wdat.cal$Location == "MB"] <- wdat.cal$Year[wdat.cal$Location == "MB"] + 4000
wdat.cal$yearmod[wdat.cal$Location == "Ontario"] <- wdat.cal$Year[wdat.cal$Location == "Ontario"] + 5000
wdat.cal$yearmod[wdat.cal$Location == "Vassal"] <- wdat.cal$Year[wdat.cal$Location == "Vassal"] + 6000
# modifying years for phenology dataset
riesling.bb$yearmod <- riesling.bb$Year
riesling.bb$yearmod[riesling.bb$Location == "Colmar"] <- riesling.bb$Year[riesling.bb$Location == "Colmar"] + 1000
riesling.bb$yearmod[riesling.bb$Location == "Lewisberg_PA"] <- riesling.bb$Year[riesling.bb$Location == "Lewisberg_PA"] + 2000
riesling.bb$yearmod[riesling.bb$Location == "Lower_Franconia"] <- riesling.bb$Year[riesling.bb$Location == "Lower_Franconia"] + 3000
riesling.bb$yearmod[riesling.bb$Location == "MB"] <- riesling.bb$Year[riesling.bb$Location == "MB"] + 4000
riesling.bb$yearmod[riesling.bb$Location == "Ontario"] <- riesling.bb$Year[riesling.bb$Location == "Ontario"] + 5000
riesling.bb$yearmod[riesling.bb$Location == "Vassal"] <- riesling.bb$Year[riesling.bb$Location == "Vassal"] + 6000
names(wdat.cal)[names(wdat.cal) == "Year"] <- "True_Year"
names(wdat.cal)[names(wdat.cal) == "yearmod"] <- "Year"
names(wdat.cal)[names(wdat.cal) == "Temperature"] <- "Temp"
names(riesling.bb)[names(riesling.bb) == "Year"] <- "True_Year"
names(riesling.bb)[names(riesling.bb) == "yearmod"] <- "Year"
# now set calibration years and generate season list
riesling.calibration <- unique(riesling.bb$Year) # all years
riesling.SeasonList <- genSeasonList(wdat.cal, years = riesling.calibration)
upper <- c(42, 200, 1.0, 30, 4000.0, 10000.0, 7000.0, 6.e13, 10, 40, 10, 50.00)
lower <- c(39, 180, 0.1, 0 , 3000.0, 9000.0, 6000.0, 5.e13, 0, 0, 0, 0.05)
RIES_model2=data.frame(NULL)
for (i in 1:30) {
set.seed(i)
Fit_res_RIES2 <- phenologyFitter(
modelfn = PhenoFlex_GDHwrapper,
bloomJDays = riesling.bb$bb.doy[which(riesling.bb$Year %in% riesling.calibration)],
SeasonList = riesling.SeasonList,
lower = lower,
upper = upper,
control = list(
smooth = FALSE,
verbose = TRUE,
maxit = 30,
nb.stop.improvement = 500
)
)
a=RMSEP(Fit_res_RIES2$pbloomJDays, Fit_res_RIES2$bloomJDays, na.rm = T)
RIES_model2=rbind(RIES_model2, c(i,a))
print(i)
}
colnames(RIES_model2)=c("seed","RMSEall")
View(RIES_model2)
set.seed(22)
Fit_res_RIES2 <- phenologyFitter(
modelfn = PhenoFlex_GDHwrapper,
bloomJDays = riesling.bb$bb.doy[which(riesling.bb$Year %in% riesling.calibration)],
SeasonList = riesling.SeasonList,
lower = lower,
upper = upper,
control = list(
smooth = FALSE,
verbose = TRUE,
maxit = 30,
nb.stop.improvement = 500
)
)
riesling.predictions <- data.frame(riesling.bb)
riesling.predictions[["Predicted"]] <- Fit_res_RIES2$pbloomJDays
riesling.predictions$Year <- NULL
names(riesling.predictions)[names(riesling.predictions) == "True_Year"] <- "Year"
riesling_mod <- lm(Predicted ~ bb.doy, riesling.predictions)
summary(riesling_mod)
mean(riesling.predictions$Predicted - riesling.predictions$bb.doy)
cabsauv.bb <- subset(bbdat, Cultivar == "Cabernet_Sauvignon")
cabsauv.bb <- droplevels(cabsauv.bb)
cabsauv.bb <- cabsauv.bb %>%
filter(!(BBCH.scale %in% c("5")))
wdat.cal <- subset(wdat3, Location %in% c("MB", "Bordeaux", "Vassal", "Colmar"))
wdat.cal <- droplevels(wdat.cal)
rownames(wdat.cal) <- NULL
# modifying years for weather dataset
wdat.cal$yearmod <- wdat.cal$Year
wdat.cal$yearmod[wdat.cal$Location == "Colmar"] <- wdat.cal$Year[wdat.cal$Location == "Colmar"] + 1000
wdat.cal$yearmod[wdat.cal$Location == "MB"] <- wdat.cal$Year[wdat.cal$Location == "MB"] + 4000
wdat.cal$yearmod[wdat.cal$Location == "Vassal"] <- wdat.cal$Year[wdat.cal$Location == "Vassal"] + 6000
# modifying years for phenology dataset
cabsauv.bb$yearmod <- cabsauv.bb$Year
cabsauv.bb$yearmod[cabsauv.bb$Location == "Colmar"] <- cabsauv.bb$Year[cabsauv.bb$Location == "Colmar"] + 1000
cabsauv.bb$yearmod[cabsauv.bb$Location == "MB"] <- cabsauv.bb$Year[cabsauv.bb$Location == "MB"] + 4000
cabsauv.bb$yearmod[cabsauv.bb$Location == "Vassal"] <- cabsauv.bb$Year[cabsauv.bb$Location == "Vassal"] + 6000
names(wdat.cal)[names(wdat.cal) == "Year"] <- "True_Year"
names(wdat.cal)[names(wdat.cal) == "yearmod"] <- "Year"
names(wdat.cal)[names(wdat.cal) == "Temperature"] <- "Temp"
names(cabsauv.bb)[names(cabsauv.bb) == "Year"] <- "True_Year"
names(cabsauv.bb)[names(cabsauv.bb) == "yearmod"] <- "Year"
# now set calibration years and generate season list
cabsauv.calibration <- unique(cabsauv.bb$Year) # all years
cabsauv.SeasonList <- genSeasonList(wdat.cal, years = cabsauv.calibration)
upper <- c(42, 200, 1.0, 30, 4000.0, 10000.0, 7000.0, 6.e13, 10, 40, 10, 50.00)
lower <- c(39, 180, 0.1, 0 , 3000.0, 9000.0, 6000.0, 5.e13, 0, 0, 0, 0.05)
CS_model2=data.frame(NULL)
for (i in 1:30) {
set.seed(i)
Fit_res_CS2 <- phenologyFitter(
modelfn = PhenoFlex_GDHwrapper,
bloomJDays = cabsauv.bb$bb.doy[which(cabsauv.bb$Year %in% cabsauv.calibration)],
SeasonList = cabsauv.SeasonList,
lower = lower,
upper = upper,
control = list(
smooth = FALSE,
verbose = TRUE,
maxit = 30,
nb.stop.improvement = 500
)
)
a=RMSEP(Fit_res_CS2$pbloomJDays, Fit_res_CS2$bloomJDays, na.rm = T)
CS_model2=rbind(CS_model2, c(i,a))
print(i)
}
colnames(CS_model2)=c("seed","RMSEall")
View(CS_model2)
set.seed(15)
Fit_res_CS2 <- phenologyFitter(
modelfn = PhenoFlex_GDHwrapper,
bloomJDays = cabsauv.bb$bb.doy[which(cabsauv.bb$Year %in% cabsauv.calibration)],
SeasonList = cabsauv.SeasonList,
lower = lower,
upper = upper,
control = list(
smooth = FALSE,
verbose = TRUE,
maxit = 30,
nb.stop.improvement = 500
)
)
cabsauv.predictions <- data.frame(cabsauv.bb)
cabsauv.predictions[["Predicted"]] <- Fit_res_CS2$pbloomJDays
cabsauv.predictions$Year <- NULL
names(cabsauv.predictions)[names(cabsauv.predictions) == "True_Year"] <- "Year"
cabsauv_mod <- lm(Predicted ~ bb.doy, cabsauv.predictions)
summary(cabsauv_mod)
mean(cabsauv.predictions$Predicted - cabsauv.predictions$bb.doy)
Portland_pheno <- data.frame(bbdat) %>%
dplyr::select(bb.date, Year, bb.doy, Location, BBCH.scale, Dataset, Cultivar, Observer) %>%
mutate(pheno = as.numeric(bb.doy)) %>%
filter(
Location == "Portland_NY",
#BBCH.scale %in% c(7),
Cultivar == "Concord") %>% arrange(Location, Year)
pheno_years_Portland <- unique(Portland_pheno$Year)
wdat.Portland <- subset(wdat2, Location %in% "Portland_NY")
Portland_easy <- data.frame(wdat.Portland) %>%
mutate(
Year = year(Date),
Month = month(Date),
Day = day(Date)
) %>%
stack_hourly_temps(latitude = unique(.$Latitude)) %>%
pluck(1) %>%
genSeasonList(mrange = c(8, 6),
years = pheno_years_Portland)
upper <- c(42, 200, 1.0, 30, 4000.0, 10000.0, 7000.0, 6.e13, 10, 40, 10, 50.00)
lower <- c(39, 180, 0.1, 0 , 3000.0, 9000.0, 6000.0, 5.e13, 0, 0, 0, 0.05)
CON_model2=data.frame(NULL)
for (i in 1:30) {
set.seed(i)
Fit_res_CON <- phenologyFitter(
modelfn = PhenoFlex_GDHwrapper,
bloomJDays = Portland_pheno$pheno,
SeasonList = Portland_easy,
lower = lower,
upper = upper,
control = list(
smooth = FALSE,
verbose = TRUE,
maxit = 30,
nb.stop.improvement = 500
)
)
Portland_pheno$predicted <-
purrr::map_dbl(Portland_easy,~ PhenoFlex_GDHwrapper(.x, Fit_res_CON$model_fit$par))
Portland_pheno$val <- 0
a=RMSEP(Portland_pheno$predicted, Portland_pheno$pheno, na.rm = T)
CON_model2=rbind(CON_model2, c(i,a))
print(i)
}
colnames(CON_model2)=c("seed","RMSEcal")
View(CON_model2)
set.seed(15)
Fit_res_CON <- phenologyFitter(
modelfn = PhenoFlex_GDHwrapper,
bloomJDays = Portland_pheno$pheno,
SeasonList = Portland_easy,
lower = lower,
upper = upper,
control = list(
smooth = FALSE,
verbose = TRUE,
maxit = 30,
nb.stop.improvement = 500
)
)
Portland_pheno$Predicted <-
purrr::map_dbl(Portland_easy,~ PhenoFlex_GDHwrapper(.x, Fit_res_CON$model_fit$par))
Portland_pheno$val <- 0
```{r All results from Method 2}
all_CON_method2=data.frame(Portland_pheno$Cultivar,Portland_pheno$Dataset, Portland_pheno$bb.doy,Portland_pheno$Predicted)
colnames(all_CON_method2)=c("Cultivar","Dataset","bb.doy","Predicted")
all_RIES_method2=data.frame(riesling.predictions$Cultivar,riesling.predictions$Dataset, riesling.predictions$bb.doy,riesling.predictions$Predicted)
colnames(all_RIES_method2)=c("Cultivar","Dataset","bb.doy","Predicted")
all_CS_method2=data.frame(cabsauv.predictions$Cultivar,cabsauv.predictions$Dataset, cabsauv.predictions$bb.doy,cabsauv.predictions$Predicted)
colnames(all_CS_method2)=c("Cultivar","Dataset","bb.doy","Predicted")
all_pheno_fullfit <- rbind(all_CS_method2,
all_RIES_method2,
all_CON_method2)
RMSEP(all_pheno_fullfit$Predicted, all_pheno_fullfit$bb.doy, na.rm = T)
mean(all_pheno_fullfit$Predicted - all_pheno_fullfit$bb.doy, na.rm = T)
fullfit_mod <- lm(Predicted ~ bb.doy, data = all_pheno_fullfit)
summary(fullfit_mod)
pal2=c( "#C32966","#234F9C", "#3B8441")
pal2b=c( "#C32966", "#3B8441")
all_pheno=rbind(cabsauv_pheno, riesling_pheno)
circle = c("0" = 19, "1" = 21)
all_cold <- ggplot(data=all_pheno)+
geom_abline(slope=1,intercept = 0, lty=1, linewidth=0.3)+
geom_point(aes(x=pheno,y=predicted, color=Cultivar, shape = as.factor(val)))+
geom_smooth(aes(x=pheno,y=predicted, lty=as.factor(val)), col="black",fill="black",method="lm")+
scale_color_manual(values=pal2b)+
scale_fill_manual(values=pal2b)+
scale_shape_manual(values = circle)+
scale_y_continuous(limits=c(40,160), breaks=seq(40,160,20))+
scale_x_continuous(limits=c(40,160), breaks=seq(40,160,20))+
ylab("") + xlab("") + labs(color="Cultivar", fill="Cultivar")+
theme_bw(base_size=8) +
#facet_wrap(.~Cultivar)+
theme(legend.position = "none",
strip.background = element_rect(color="#CCCCCC"),
panel.grid = element_blank(),
panel.border = element_blank(),
axis.line.x = element_line(linewidth=0.1,color="black"),
axis.line.y = element_line(linewidth=0.1,color="black"),
axis.text = element_text(size=8, color="black"),
axis.ticks = element_line(linewidth=0.1,color="black"),
axis.ticks.length = unit(0.2, 'lines'),
axis.text.x = element_text(angle=0,vjust=0, hjust=0.5),
aspect.ratio = 1)
riesling_cold <- ggplot(data=riesling_pheno)+
geom_abline(slope=1,intercept = 0, lty=1, linewidth=0.3)+
geom_smooth(aes(x=pheno,y=predicted), color="#3B8441",fill="#3B8441",method="lm")+
geom_point(aes(x=pheno,y=predicted, shape = as.factor(val)), color="#3B8441")+
scale_color_manual(values=pal2)+
scale_fill_manual(values=pal2)+
scale_shape_manual(values = circle)+
scale_y_continuous(limits=c(40,160), breaks=seq(40,160,20))+
scale_x_continuous(limits=c(40,160), breaks=seq(40,160,20))+
ylab("") + xlab("") + labs(color="Cultivar", fill="Cultivar")+
theme_bw(base_size=8) +
#facet_wrap(.~Cultivar)+
theme(legend.position = "none",
strip.background = element_rect(color="#CCCCCC"),
panel.grid = element_blank(),
panel.border = element_blank(),
axis.line.x = element_line(linewidth=0.1,color="black"),
axis.line.y = element_line(linewidth=0.1,color="black"),
axis.text = element_text(size=8, color="black"),
axis.ticks = element_line(linewidth=0.1,color="black"),
axis.ticks.length = unit(0.2, 'lines'),
axis.text.x = element_blank(),
aspect.ratio = 1)
cabsauv_cold <- ggplot(data=cabsauv_pheno)+
geom_abline(slope=1,intercept = 0, lty=1, linewidth=0.3)+
geom_smooth(aes(x=pheno,y=predicted), color="#C32966",fill="#C32966",method="lm")+
geom_point(aes(x=pheno,y=predicted, shape = as.factor(val)), color="#C32966")+
scale_color_manual(values=pal2)+
scale_fill_manual(values=pal2)+
scale_shape_manual(values = circle)+
scale_y_continuous(limits=c(40,160), breaks=seq(40,160,20))+
scale_x_continuous(limits=c(40,160), breaks=seq(40,160,20))+
ylab("") + xlab("") + labs(color="Cultivar", fill="Cultivar")+
theme_bw(base_size=8) +
#facet_wrap(.~Cultivar)+
theme(legend.position = "none",
strip.background = element_rect(color="#CCCCCC"),
panel.grid = element_blank(),
panel.border = element_blank(),
axis.line.x = element_line(linewidth=0.1,color="black"),
axis.line.y = element_line(linewidth=0.1,color="black"),
axis.text = element_text(size=8, color="black"),
axis.ticks = element_line(linewidth=0.1,color="black"),
axis.ticks.length = unit(0.2, 'lines'),
axis.text.x = element_blank(),
aspect.ratio = 1)
all_plots_cold <- cabsauv_cold / riesling_cold
all_cold+all_plots_cold
#RMSE val
RMSEP(all_pheno$predicted[all_pheno$val==1], all_pheno$pheno[all_pheno$val==1], na.rm = T)
#bias val
mean(all_pheno$predicted[all_pheno$val==1] - all_pheno$pheno[all_pheno$val==1], na.rm = T)
#r2 val
(cor(all_pheno$predicted[all_pheno$val==1], all_pheno$pheno[all_pheno$val==1]))^2
length(all_pheno$predicted[all_pheno$val==1])
#RMSE cal
RMSEP(all_pheno$predicted[all_pheno$val==0], all_pheno$pheno[all_pheno$val==0], na.rm = T)
#bias cal
mean(all_pheno$predicted[all_pheno$val==0] - all_pheno$pheno[all_pheno$val==0], na.rm = T)
#r2 cal
(cor(all_pheno$predicted[all_pheno$val==0], all_pheno$pheno[all_pheno$val==0]))^2
#RMSE val
RMSEP(cabsauv_pheno$predicted[cabsauv_pheno$val==1], cabsauv_pheno$pheno[cabsauv_pheno$val==1], na.rm = T)
#bias val
mean(cabsauv_pheno$predicted[cabsauv_pheno$val==1] - cabsauv_pheno$pheno[cabsauv_pheno$val==1], na.rm = T)
#r2 val
(cor(cabsauv_pheno$predicted[cabsauv_pheno$val==1], cabsauv_pheno$pheno[cabsauv_pheno$val==1]))^2
length(cabsauv_pheno$predicted[cabsauv_pheno$val==1])
#RMSE cal
RMSEP(cabsauv_pheno$predicted[cabsauv_pheno$val==0], cabsauv_pheno$pheno[cabsauv_pheno$val==0], na.rm = T)
#bias cal
mean(cabsauv_pheno$predicted[cabsauv_pheno$val==0] - cabsauv_pheno$pheno[cabsauv_pheno$val==0], na.rm = T)
#r2 cal
(cor(cabsauv_pheno$predicted[cabsauv_pheno$val==0], cabsauv_pheno$pheno[cabsauv_pheno$val==0]))^2
length(cabsauv_pheno$predicted[cabsauv_pheno$val==0])
#RMSE val
RMSEP(riesling_pheno$predicted[riesling_pheno$val==1], riesling_pheno$pheno[riesling_pheno$val==1], na.rm = T)
#bias val
mean(riesling_pheno$predicted[riesling_pheno$val==1] - riesling_pheno$pheno[riesling_pheno$val==1], na.rm = T)
#r2 val
(cor(riesling_pheno$predicted[riesling_pheno$val==1], riesling_pheno$pheno[riesling_pheno$val==1]))^2
length(riesling_pheno$predicted[riesling_pheno$val==1])
#RMSE cal
RMSEP(riesling_pheno$predicted[riesling_pheno$val==0], riesling_pheno$pheno[riesling_pheno$val==0], na.rm = T)
#bias cal
mean(riesling_pheno$predicted[riesling_pheno$val==0] - riesling_pheno$pheno[riesling_pheno$val==0], na.rm = T)
#r2 cal
(cor(riesling_pheno$predicted[riesling_pheno$val==0], riesling_pheno$pheno[riesling_pheno$val==0]))^2
length(riesling_pheno$predicted[riesling_pheno$val==0])
fullfit_all <- ggplot(data=all_pheno_fullfit)+
geom_abline(slope=1,intercept = 0, lty=1, linewidth=0.3)+
geom_point(aes(x=bb.doy,y=Predicted, color=Cultivar))+
geom_smooth(aes(x=bb.doy,y=Predicted), col="black",fill="black",method="lm")+
scale_color_manual(values=pal2)+
scale_fill_manual(values=pal2)+
scale_y_continuous(limits=c(40,160), breaks=seq(40,160,20))+
scale_x_continuous(limits=c(40,160), breaks=seq(40,160,20))+
ylab("") + xlab("") +
theme_bw(base_size=8) +
#facet_wrap(.~Cultivar)+
theme(legend.position = "none",
strip.background = element_rect(color="#CCCCCC"),
panel.grid = element_blank(),
panel.border = element_blank(),
axis.line.x = element_line(linewidth=0.1,color="black"),
axis.line.y = element_line(linewidth=0.1,color="black"),
axis.text = element_text(size=8, color="black"),
axis.ticks = element_line(linewidth=0.1,color="black"),
axis.ticks.length = unit(0.2, 'lines'),
axis.text.x = element_text(angle=0,vjust=0, hjust=0.5),
aspect.ratio = 1)
fullfit_concord <- ggplot(data=subset(all_pheno_fullfit, Cultivar %in% "Concord"))+
geom_abline(slope=1,intercept = 0, lty=1, linewidth=0.3)+
geom_smooth(aes(x=bb.doy,y=Predicted), color="#234F9C",fill="#234F9C",method="lm")+
geom_point(aes(x=bb.doy,y=Predicted), color="#234F9C")+
scale_color_manual(values=pal2)+
scale_fill_manual(values=pal2)+
scale_y_continuous(limits=c(40,160), breaks=seq(40,160,20))+
scale_x_continuous(limits=c(40,160), breaks=seq(40,160,20))+
ylab("") + xlab("") +
theme_bw(base_size=8) +
#facet_wrap(.~Cultivar)+
theme(legend.position = "none",
strip.background = element_rect(color="#CCCCCC"),
panel.grid = element_blank(),
panel.border = element_blank(),
axis.line.x = element_line(linewidth=0.1,color="black"),
axis.line.y = element_line(linewidth=0.1,color="black"),
axis.text = element_text(size=8, color="black"),
axis.ticks = element_line(linewidth=0.1,color="black"),
axis.ticks.length = unit(0.2, 'lines'),
axis.text.x = element_text(angle=45,vjust=0, hjust=0.5),
aspect.ratio = 1)
fullfit_riesling <- ggplot(data=subset(all_pheno_fullfit, Cultivar %in% "Riesling"))+
geom_abline(slope=1,intercept = 0, lty=1, linewidth=0.3)+
geom_smooth(aes(x=bb.doy,y=Predicted), color="#3B8441",fill="#3B8441",method="lm")+
geom_point(aes(x=bb.doy,y=Predicted), color="#3B8441")+
scale_color_manual(values=pal2)+
scale_fill_manual(values=pal2)+
scale_y_continuous(limits=c(40,160), breaks=seq(40,160,20))+
scale_x_continuous(limits=c(40,160), breaks=seq(40,160,20))+
ylab("") + xlab("") + labs(color="Cultivar", fill="Cultivar")+
theme_bw(base_size=8) +
#facet_wrap(.~Cultivar)+
theme(legend.position = "none",
strip.background = element_rect(color="#CCCCCC"),
panel.grid = element_blank(),
panel.border = element_blank(),
axis.line.x = element_line(linewidth=0.1,color="black"),
axis.line.y = element_line(linewidth=0.1,color="black"),
axis.text = element_text(size=8, color="black"),
axis.ticks = element_line(linewidth=0.1,color="black"),
axis.ticks.length = unit(0.2, 'lines'),
axis.text.x = element_blank(),
aspect.ratio = 1)
fullfit_cabsauv <- ggplot(data=subset(all_pheno_fullfit, Cultivar %in% "Cabernet_Sauvignon"))+
geom_abline(slope=1,intercept = 0, lty=1, linewidth=0.3)+
geom_smooth(aes(x=bb.doy,y=Predicted), color="#C32966",fill="#C32966",method="lm")+
geom_point(aes(x=bb.doy,y=Predicted), color="#C32966")+
scale_color_manual(values=pal2)+
scale_fill_manual(values=pal2)+
scale_y_continuous(limits=c(40,160), breaks=seq(40,160,20))+
scale_x_continuous(limits=c(40,160), breaks=seq(40,160,20))+
ylab("") + xlab("") + labs(color="Cultivar", fill="Cultivar")+
theme_bw(base_size=8) +
#facet_wrap(.~Cultivar)+
theme(legend.position = "none",
strip.background = element_rect(color="#CCCCCC"),
panel.grid = element_blank(),
panel.border = element_blank(),
axis.line.x = element_line(linewidth=0.1,color="black"),
axis.line.y = element_line(linewidth=0.1,color="black"),
axis.text = element_text(size=8, color="black"),
axis.ticks = element_line(linewidth=0.1,color="black"),
axis.ticks.length = unit(0.2, 'lines'),
axis.text.x = element_blank(),
aspect.ratio = 1)
all_plots_fullfit <- fullfit_cabsauv / fullfit_riesling / fullfit_concord
fullfit_all + all_plots_fullfit
#RMSE val
RMSEP(all_pheno_fullfit$Predicted, all_pheno_fullfit$bb.doy, na.rm = T)
#bias val
mean(all_pheno_fullfit$Predicted-all_pheno_fullfit$bb.doy, na.rm = T)
#r2 val
(cor(all_pheno_fullfit$Predicted, all_pheno_fullfit$bb.doy))^2
# Cab-Sauv
csall_pheno_fullfit=subset(all_pheno_fullfit, Cultivar %in% "Cabernet_Sauvignon")
#RMSE val
RMSEP(csall_pheno_fullfit$Predicted, csall_pheno_fullfit$bb.doy, na.rm = T)
#bias val
mean(csall_pheno_fullfit$Predicted-csall_pheno_fullfit$bb.doy, na.rm = T)
#r2 val
(cor(csall_pheno_fullfit$Predicted, csall_pheno_fullfit$bb.doy))^2
# Riesling
riesall_pheno_fullfit=subset(all_pheno_fullfit, Cultivar %in% "Riesling")
#RMSE val
RMSEP(riesall_pheno_fullfit$Predicted, riesall_pheno_fullfit$bb.doy, na.rm = T)
#bias val
mean(riesall_pheno_fullfit$Predicted-riesall_pheno_fullfit$bb.doy, na.rm = T)
#r2 val
(cor(riesall_pheno_fullfit$Predicted, riesall_pheno_fullfit$bb.doy))^2
# Concord
conall_pheno_fullfit=subset(all_pheno_fullfit, Cultivar %in% "Concord")
#RMSE val
RMSEP(conall_pheno_fullfit$Predicted, conall_pheno_fullfit$bb.doy, na.rm = T)
#bias val
mean(conall_pheno_fullfit$Predicted-conall_pheno_fullfit$bb.doy, na.rm = T)
#r2 val
(cor(conall_pheno_fullfit$Predicted, conall_pheno_fullfit$bb.doy))^2
